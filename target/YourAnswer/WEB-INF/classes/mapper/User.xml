<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
    <mapper namespace="ssm.mapper.UserMapper">
    	<resultMap id="BaseResultMap" type="ssm.pojo.User" >
    		<id column="uId" property="uId" jdbcType="INTEGER" />
    		<result column="uPassword" property="uPassword" jdbcType="VARCHAR" />
    		<result column="uEmail" property="uEmail" jdbcType="VARCHAR" />
    		<result column="uRealName" property="uRealName" jdbcType="VARCHAR" />
    		<result column="uTel" property="uTel" jdbcType="VARCHAR" />
    		<result column="uRegistDate" property="uRegistDate" />
    		
    		<result column="uName" property="uName" jdbcType="VARCHAR" />
    		<result column="uGender" property="uGender" jdbcType="VARCHAR" />
    		<result column="uWord" property="uWord" jdbcType="VARCHAR" />
    		<result column="uResidence" property="uResidence" jdbcType="VARCHAR" />
    		<result column="uProfession" property="uProfession" jdbcType="VARCHAR" />
  		</resultMap>
  		<sql id="User_Column_List" >
    		uId, uEmail, uRealName, uTel, uRegistDate, uName, uGender, uWord, uResidence, uProfession
  		</sql>
    	
    	<insert id="addUser" parameterType="ssm.pojo.User" >
            INSERT INTO user (uName ,uPassword,uEmail,uRealName,uTel,uGender) 
            	SELECT #{uName} ,#{uPassword} ,#{uEmail} ,#{uRealName},#{uTel},#{uGender}    
            	FROM DUAL WHERE NOT EXISTS(SELECT uEmail FROM user WHERE uEmail = #{uEmail}) 
        </insert>
        
        <select id="hasUEmail" resultMap="BaseResultMap"  parameterType="java.lang.String" >
        	SELECT <include refid="User_Column_List" /> FROM  user WHERE uEmail = #{uEmail}
        </select>
         
        <delete id="deleteUserById" parameterType="java.lang.Integer" >
            DELETE from user where uId= #{uId}   
        </delete>
         
        <update id="updateUser" parameterType="ssm.pojo.User" >
            UPDATE user
		    <set >
		    	<if test="uName != null" >
		       		uName = #{uName,jdbcType=VARCHAR},
		     	</if>
		     	<if test="uGender != null" >
		       		uGender = #{uGender,jdbcType=VARCHAR},
		     	</if>
		     	<if test="uWord != null" >
		     		uWord = #{uWord,jdbcType=VARCHAR},
		     	</if>
		     	<if test="uResidence != null" >
		     		uResidence = #{uResidence,jdbcType=VARCHAR},
		     	</if>
		     	<if test="uProfession != null" >
		     		uProfession = #{uProfession,jdbcType=VARCHAR},
		     	</if>
		   	</set>
		   	WHERE uId = #{uId,jdbcType=INTEGER}   
        </update>
        
        <update id="updateUserPassword" parameterType="ssm.pojo.User" >
            UPDATE user
		    <set >
		     	<if test="uPassword != null" >
		     		uPassword = #{uPassword,jdbcType=VARCHAR},
		     	</if>
		   	</set>
		   	WHERE uId = #{uId,jdbcType=INTEGER}   
        </update>

        <select id="isUser" resultMap="BaseResultMap" parameterType="ssm.pojo.User"  >
            SELECT  <include refid="User_Column_List" />
            	 FROM user WHERE uEmail=#{uEmail} and uPassword=#{uPassword}
        </select>

        <select id="queryUserById" resultType="ssm.pojo.User" parameterType="java.lang.Integer">
            SELECT <include refid="User_Column_List" /> FROM user  WHERE uId= #{uId}
        </select>
 
        <select id="listUser" resultType="User">
            SELECT * FROM  user      
        </select>     
    </mapper>